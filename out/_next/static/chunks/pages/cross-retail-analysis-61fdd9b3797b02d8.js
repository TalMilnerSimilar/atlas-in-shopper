(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[449],{6822:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cross-retail-analysis",function(){return a(7661)}])},7661:function(e,t,a){"use strict";a.r(t);var r=a(5893),n=a(7294),l=a(6196),s=a(6691),o=a(199),i=a(9057),d=a(5759),c=a(8688),h=a(6116),u=a(7069),m=a(1833),g=a(6420),p=a(1230),f=a(8225),x=a(8908),S=a(8458),v=a(9876),w=a(2991),b=a(6360),y=a(8824),C=a(3717),M=a(2074),N=a(1167);t.default=()=>{let[e,t]=(0,n.useState)("retailer-growth"),[a,E]=(0,n.useState)(!0),[T,k]=(0,n.useState)(!1),[F,B]=(0,n.useState)(!1),[L,j]=(0,n.useState)(null),[P,R]=(0,n.useState)({x:0,y:0}),[I,D]=(0,n.useState)(new Set),[H,A]=(0,n.useState)([]),[K,_]=(0,n.useState)(null),[Z,W]=(0,n.useState)({x:0,y:0}),[Y,O]=(0,n.useState)(!0),[J,z]=(0,n.useState)(!0),[G,q]=(0,n.useState)("Jun 2024 - Jul 2024"),[X,$]=(0,n.useState)("Year over Year"),[V,U]=(0,n.useState)("Appliances > Dishwashers"),[Q,ee]=(0,n.useState)(["All Retailers"]),[et,ea]=(0,n.useState)(["All Brands"]),[er,en]=(0,n.useState)("Nike"),el=["#195AFE","#22C55E","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#F97316"],[es,eo]=(0,n.useState)({}),[ei,ed]=(0,n.useState)({}),[ec,eh]=(0,n.useState)([]),[eu,em]=(0,n.useState)({}),eg=(0,n.useRef)({});(0,n.useEffect)(()=>{let e=!0;return fetch("/data/retailer_series.csv",{cache:"no-store"}).then(e=>e.text()).then(t=>{let a={};t.split(/\r?\n/).forEach(e=>{let t=(e||"").trim();if(!t||t.startsWith("#")||/^key\b/i.test(t))return;let r=t.split(",").map(e=>e.trim());if(r.length<22)return;let n=r[0],l=r.slice(1,8).map(e=>parseInt(e,10)).filter(e=>!Number.isNaN(e)),s=r.slice(8,15).map(e=>parseInt(e,10)).filter(e=>!Number.isNaN(e)),o=r.slice(15,22).map(e=>parseInt(e,10)).filter(e=>!Number.isNaN(e));n&&7===l.length&&7===s.length&&7===o.length&&(a[n.toLowerCase()]={current:l,prevPop:s,prevYoy:o})}),e&&em(a)}).catch(()=>{}).finally(()=>{}),()=>{e=!1}},[]),(0,n.useEffect)(()=>{let e=localStorage.getItem("marketPositionEnabled");null!==e&&O(JSON.parse(e));let handleMarketPositionToggle=e=>{O(e.detail.enabled)};return window.addEventListener("marketPositionToggle",handleMarketPositionToggle),()=>{window.removeEventListener("marketPositionToggle",handleMarketPositionToggle)}},[]),(0,n.useEffect)(()=>{let e=localStorage.getItem("brandStrongholdsEnabled");null!==e&&z(JSON.parse(e));let handleBrandStrongholdsToggle=e=>{z(e.detail.enabled)};return window.addEventListener("brandStrongholdsToggle",handleBrandStrongholdsToggle),()=>window.removeEventListener("brandStrongholdsToggle",handleBrandStrongholdsToggle)},[]),(0,n.useEffect)(()=>{let handleScrollToStrongholds=()=>{let e=document.querySelector("[data-strongholds-section]");e&&e.scrollIntoView({behavior:"smooth",block:"start"})};return window.addEventListener("scrollToBrandStrongholds",handleScrollToStrongholds),()=>window.removeEventListener("scrollToBrandStrongholds",handleScrollToStrongholds)},[]);let[ep,ef]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("tableKPIsEnabled");null!==e&&ef(JSON.parse(e));let handleTableKPIsToggle=e=>{ef(e.detail.enabled)};return window.addEventListener("tableKPIsToggle",handleTableKPIsToggle),()=>{window.removeEventListener("tableKPIsToggle",handleTableKPIsToggle)}},[]);let[ex,eS]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("tableFiltersEnabled");null!==e&&eS(JSON.parse(e));let handleTableFiltersToggle=e=>{eS(e.detail.enabled)};return window.addEventListener("tableFiltersToggle",handleTableFiltersToggle),()=>{window.removeEventListener("tableFiltersToggle",handleTableFiltersToggle)}},[]);let[ev,ew]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("groupedByRegionEnabled");null!==e&&ew(JSON.parse(e));let handleGroupedByRegionToggle=e=>{ew(e.detail.enabled)};return window.addEventListener("groupedByRegionToggle",handleGroupedByRegionToggle),()=>{window.removeEventListener("groupedByRegionToggle",handleGroupedByRegionToggle)}},[]);let expandSelectedHosts=e=>{let regionMatch=e=>/^all\s+(us|uk|german|french|canadian|australian)\s+retailers$/i.exec((e||"").trim()),t=y.x.filter(e=>!/^all\s+/i.test(e));if(e.some(e=>/^all\s+retailers$/i.test((e||"").trim())))return t;let a=new Set;e.forEach(e=>{let t=regionMatch(e);t&&a.add(t[1].toLowerCase())});let r=[],addPred=e=>r.push(e);a.has("us")&&addPred(e=>e.endsWith(".com")),a.has("uk")&&addPred(e=>e.endsWith(".co.uk")),a.has("german")&&addPred(e=>e.endsWith(".de")),a.has("french")&&addPred(e=>e.endsWith(".fr")),a.has("canadian")&&addPred(e=>e.endsWith(".ca")),a.has("australian")&&addPred(e=>e.endsWith(".com.au"));let norm=e=>(e||"").trim().toLowerCase(),n=new Set(e.filter(e=>!/^all\s+/i.test(e)).map(e=>norm(e))),l=[];for(let e of t){let t=norm(e);(n.has(t)||r.length>0&&r.some(e=>e(t)))&&l.push(e)}return l},computeSkusForHost=e=>{let t=(e||"").toLowerCase();if(t.includes("amazon"))return 5846;if(t.includes("walmart"))return 3425;if(t.includes("samsung"))return 1468;if(t.includes("bestbuy"))return 968;if(t.includes("ebay"))return 846;if(t.includes("newegg"))return 725;if(t.includes("homedepot"))return 709;if(t.includes("costco"))return 650;if(t.includes("tesco"))return 645;if(t.includes("lowes"))return 599;let a=0;for(let e=0;e<t.length;e++)a=31*a+t.charCodeAt(e)>>>0;return 300+a%1201},formatSkus=e=>e>=1e3?"".concat((e/1e3).toFixed(1).replace(/\.0$/,""),"K"):e.toString(),resolveChartKey=e=>{let t=(e||"").toLowerCase();return t.includes("amazon")?"Amazon.com":t.includes("walmart")?"Walmart.com":t.includes("samsung")?"Samsung.com":t.includes("bestbuy")?"Bestbuy.com":t.includes("ebay")?"Ebay.com":t.includes("newegg")?"Newegg.com":t.includes("homedepot")?"Homedepot.com":t.includes("costco")?"Costco.com":t.includes("tesco")?"Tesco.com":t.includes("lowes")?"Lowes.com":e},hashString=e=>{let t=2166136261;for(let a=0;a<e.length;a++)t^=e.charCodeAt(a),t=Math.imul(t,16777619);return t>>>0},randFromSeed=e=>{let t=(e||1)>>>0;return()=>(t=Math.imul(1664525,t)+1013904223>>>0)/4294967296},generateSeriesForKey=e=>{let t=hashString((e||"").toLowerCase()),a=randFromSeed(t),r=8e4+Math.floor(16e4*a()),n=-.18+.4*a(),l=[];for(let e=0;e<7;e++){let t=e/6,s=(a()-.5)*.1,o=1+n*t+s;l.push(Math.max(1e3,1e3*Math.round(r*o/1e3)))}return l},getSeriesForRetailer=e=>{let t=(e||"").trim().toLowerCase();if(eu[t]&&eu[t].current.length>0)return eu[t].current;let a=(resolveChartKey(e)||"").trim();if(eu[a])return eu[a].current;let r=a.toLowerCase();if(eu[r])return eu[r].current;let n=eg.current;return n[t]||(n[t]=generateSeriesForKey(t)),n[t]},eb=(e=>{let t=0;for(let a=0;a<e.length;a++)t=31*t+e.charCodeAt(a)>>>0;let a=10+t%86,r=Math.max(10,Math.min(95,Math.round(a))),n="".concat((1.5+r/100*17.2).toFixed(1),"M");return{position:"".concat(Math.max(2,Math.min(98,r)),"%"),percentile:r,rank:Math.max(1,Math.min(60,Math.round((100-r)/100*60))),total:60,status:r>=95?"market leader":r>=60?"ahead":r>=45?"median":r>=25?"behind":"trailing",views:n}})(er),ey={Co:{name:"Coca-Cola",percentile:10,rank:54,total:60,status:"trailing",views:"1.8M"},Pu:{name:"Puma",percentile:25,rank:45,total:60,status:"behind",views:"3.2M"},DM:{name:"Dior & Mo\xebt",percentile:40,rank:36,total:60,status:"behind",views:"5.1M"},Ad:{name:"Adidas",percentile:50,rank:30,total:60,status:"median",views:"7.4M"},[er]:{name:er,percentile:eb.percentile,rank:eb.rank,total:eb.total,status:eb.status,views:eb.views},NB:{name:"New Balance",percentile:95,rank:3,total:60,status:"market leader",views:"18.7M"}},eC=(()=>{if(0===H.length)return{min:0,max:100,steps:[0,25,50,75,100]};let e=H.map(e=>getSeriesForRetailer(e)).flat(),t=Math.min(...e),a=Math.max(...e),r=a-t,n=Math.max(0,Math.floor(t-.1*r)),l=Math.ceil(a+.1*r),s=(l-n)/6,o=Array.from({length:7},(e,t)=>Math.round(n+s*t));return{min:n,max:l,steps:o}})(),eM=[...eC.steps].reverse(),eN="Year over Year"===X?"YoY":"PoP",getInsightSeries=()=>H.map(e=>{let t=getSeriesForRetailer(e),a="YoY"===eN,r=e.split("").reduce((e,t)=>e+t.charCodeAt(0),0),n=.85+r%30/100,l=(r%7-3)/100,s=t.map((e,t)=>Math.round(e*Math.max(.5,Math.min(1.5,(a?n:.95+(r+t)%10/100)+l*t))));return{retailer:e,current:t,previous:s}}),eE=(0,n.useMemo)(()=>{if(0===H.length)return{headline:"No retailers selected.",sentence:"Select retailers from the legend to see insights.",chips:[]};if("brand-performance"===e){let e=ec.map(e=>e.name),t=e.map(e=>{let t=getSeriesForRetailer(e),a=e.toLowerCase(),r=eu[a],n=[],l=[];if(r)n=r.prevPop,l=r.prevYoy;else{let a=e.split("").reduce((e,t)=>e+t.charCodeAt(0),0),r=(a%7-3)/100;n=t.map((e,t)=>0===e&&a%3==0?5e4+a%2e4:e>0&&a%4==1?0:Math.round(e*Math.max(.5,Math.min(1.5,1+(((a>>2)+t)%21-10)/100+r*t))));let s=1+(a%51-25)/100;l=t.map((e,t)=>0===e&&a%5==0?4e4+a%15e3:e>0&&a%6==2?0:Math.round(e*Math.max(.5,Math.min(1.5,s+r*t))))}return{retailer:e,current:t,prevPop:n,prevYoy:l}}),a=(0,s.a)(t,{eligible:new Set(H)}),r=[];if(a.tags.pop){let e=a.tags.pop.startsWith("+")?"pos":a.tags.pop.startsWith("−")?"neg":"neu";r.push({text:a.tags.pop,tone:e})}if(a.tags.yoy){let e=a.tags.yoy.startsWith("+")?"pos":a.tags.yoy.startsWith("−")?"neg":"neu";r.push({text:a.tags.yoy,tone:e})}return{headline:a.title,sentence:a.text,chips:r}}let t=getInsightSeries(),a=eN.toLowerCase(),r=(0,l.F)(t,a),n=r.retailer,o=getSeriesForRetailer(n),i=n.split("").reduce((e,t)=>e+t.charCodeAt(0),0),d=(i%7-3)/100,c=o.map((e,t)=>Math.round(e*Math.max(.5,Math.min(1.5,.95+(i+t)%10/100+d*t)))),h=.85+i%30/100,u=o.map((e,t)=>Math.round(e*Math.max(.5,Math.min(1.5,h+d*t)))),m=o.reduce((e,t)=>e+t,0),g=c.reduce((e,t)=>e+t,0),p=u.reduce((e,t)=>e+t,0),f=(m-g)/Math.max(g,1),x=(m-p)/Math.max(p,1),S=[],v=(100*f).toFixed(0);S.push({text:"".concat(f>0?"+":"").concat(v,"% PoP"),tone:f>0?"pos":f<0?"neg":"neu"});let w=(100*x).toFixed(0);return S.push({text:"".concat(x>0?"+":"").concat(w,"% YoY"),tone:x>0?"pos":x<0?"neg":"neu"}),{headline:r.headline,sentence:r.sentence,chips:S}},[H,X,e]);return(0,n.useEffect)(()=>{let e=expandSelectedHosts(Q),t=e.map(e=>({name:e,skus:computeSkusForHost(e)}));t.sort((e,t)=>t.skus-e.skus),eh(t);let a=t.slice(0,Math.min(4,t.length)).map(e=>e.name);A(a),D(new Set(a.map(e=>resolveChartKey(e))));let r={};a.forEach((e,t)=>{r[e]=el[t%el.length]}),eo(r);let n={};a.forEach((e,t)=>{n[e]=t%7}),ed(n)},[]),(0,n.useEffect)(()=>{(()=>{let e=localStorage.getItem("navbarPinned");E("false"!==e)})();let handleNavbarChange=e=>{E(e.detail.isPinned)},handleNavbarHoverChange=e=>{k(e.detail.isHovered)};return window.addEventListener("navbarPinChange",handleNavbarChange),window.addEventListener("navbarHoverChange",handleNavbarHoverChange),()=>{window.removeEventListener("navbarPinChange",handleNavbarChange),window.removeEventListener("navbarHoverChange",handleNavbarHoverChange)}},[]),(0,n.useEffect)(()=>{let handleScroll=e=>{let t=e.target,a=t.scrollTop;B(a>100)},e=document.querySelector(".content-area");if(e)return e.addEventListener("scroll",handleScroll),()=>e.removeEventListener("scroll",handleScroll)},[]),(0,r.jsxs)("div",{className:"flex h-screen overflow-hidden",style:{backgroundColor:"#ffffff"},children:[(0,r.jsx)("div",{className:"bg-white border-r border-gray-200 flex flex-col transition-all duration-300 ".concat(a||T?"w-64":"w-12"," ").concat(a?"relative":T?"absolute z-50":"relative"),children:(0,r.jsx)(o.Z,{})}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,r.jsxs)("div",{className:"transition-all duration-300 ".concat(a?"px-16":"px-8"," ").concat(F?"py-3 bg-[#f7f7f8]":"py-4 bg-gray-50"),children:[(0,r.jsx)("div",{className:"transition-all duration-300 ".concat(F?"opacity-0 h-0 overflow-hidden":"opacity-100 h-auto"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-xl font-medium text-gray-900",children:"Cross Retail Analysis"}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-[12px] text-[#6B7C8C] leading-[16px]",style:{fontFamily:"DM Sans, sans-serif"},children:"For"}),(0,r.jsx)(u.Z,{value:G,onDateChange:(e,t)=>{let formatDate=e=>e.toLocaleDateString("en-US",{month:"short",year:"numeric"});q("".concat(formatDate(e)," - ").concat(formatDate(t)))}})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-[12px] text-[#6B7C8C] leading-[16px]",style:{fontFamily:"DM Sans, sans-serif"},children:"Compared to"}),(0,r.jsx)(h.Z,{label:"",value:X,options:N.A,onChange:$})]})]})]})}),(0,r.jsx)("div",{className:"transition-all duration-300 ".concat(F?"mt-0":"mt-4"),children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(i.Z,{label:"Category",value:V,options:b.O,onChange:U}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Across"}),(0,r.jsx)(d.Z,{label:"Retailers",value:Q,options:y.x,onChange:e=>{ee(e);let t=expandSelectedHosts(e),a=t.map(e=>({name:e,skus:computeSkusForHost(e)}));a.sort((e,t)=>t.skus-e.skus),eh(a);let r=a.slice(0,Math.min(4,a.length)).map(e=>e.name);A(r),D(new Set(r.map(e=>resolveChartKey(e))));let n={};r.forEach((e,t)=>{n[e]=el[t%el.length]}),eo(n);let l={};r.forEach((e,t)=>{l[e]=t%7}),ed(l)},showGroupedByRegion:ev}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"For"}),(0,r.jsx)(c.Z,{label:"Brands",value:et,options:M.K,onChange:ea}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Against my brand"}),(0,r.jsx)(i.Z,{label:"My Brand",value:er,options:C.t,onChange:en})]})})]}),(0,r.jsxs)("div",{className:"content-area flex-1 overflow-y-auto transition-all duration-300 ".concat(a?"px-16 py-8":"px-16 py-6"),children:[(0,r.jsx)(m.Z,{}),(0,r.jsx)(g.Z,{onNavigateToTab:e=>{t(e),setTimeout(()=>{let e=document.querySelector("[data-chart-section]");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)}}),Y&&(0,r.jsx)(p.Z,{brandSel:er,currentBrandData:eb,brandData:ey,onBrandHover:(e,t)=>{j(e),R({x:t.clientX,y:t.clientY})},onBrandLeave:()=>{j(null)},getOrdinal:e=>{let t=e%10,a=e%100;return 1===t&&11!==a?"".concat(e,"st"):2===t&&12!==a?"".concat(e,"nd"):3===t&&13!==a?"".concat(e,"rd"):"".concat(e,"th")},getBrandHeadline:(e,t)=>{switch(e){case"market leader":return"".concat(t," is the market leader");case"ahead":return"".concat(t," is ahead of the median");case"median":return"".concat(t," is around the median");case"behind":return"".concat(t," is behind the median");case"trailing":return"".concat(t," is trailing the category");default:return"".concat(t," performance insight")}}}),(0,r.jsx)("div",{"data-chart-section":!0,children:(0,r.jsx)(f.Z,{activeTab:e,setActiveTab:t,retailerSelectedLegendHosts:H,brandSelectedLegendHosts:[],selectedBrandName:er,yAxisScale:eC,reversedSteps:eM,formatSkus:formatSkus,getSeriesForRetailer:getSeriesForRetailer,seriesColorByRetailer:es,hoveredDateIdx:K,setHoveredDateIdx:_,setChartHoverPos:W,legendRetailers:ec,maxRetailerSelections:7,onRetailerLegendToggle:e=>{A(t=>{let a=t.includes(e),r=a?t.filter(t=>t!==e):t.length<7?[...t,e]:t;D(new Set(r.map(e=>resolveChartKey(e))));let n={};r.forEach((e,t)=>{n[e]=el[t%el.length]}),eo(n);let l={};return r.forEach((e,t)=>{l[e]=t%7}),ed(l),r})},onBrandLegendToggle:()=>{},onRetailerClearAll:()=>{A([]),D(new Set),eo({})},onBrandClearAll:()=>{},onRetailerSelectAll:()=>{let e=ec.slice(0,7).map(e=>e.name);A(e);let t=e.map(e=>resolveChartKey(e));D(new Set(t));let a={};e.forEach((e,t)=>{a[e]=el[t%el.length]}),eo(a);let r={};e.forEach((e,t)=>{r[e]=t%7}),ed(r)},onBrandSelectAll:()=>{},isRetailerLegendItemDisabled:e=>!H.includes(e)&&H.length>=7,isBrandLegendItemDisabled:()=>!1,dynamicInsight:eE,brandsFromHeader:et})}),J&&(0,r.jsx)("div",{className:"mt-10","data-strongholds-section":!0,children:(0,r.jsx)(S.Z,{legendRetailers:ec,selectedBrandName:er,selectedBrandsHeader:et,getSeriesForRetailer:getSeriesForRetailer,dateRange:G})}),(0,r.jsx)("div",{className:"mt-10",children:(0,r.jsx)(x.Z,{retailers:(()=>{let e=ec.map(e=>e.name);return e.map(e=>{let t=getSeriesForRetailer(e),a=t.reduce((e,t)=>e+t,0)/Math.max(1,t.length),r=e.split("").reduce((e,t)=>e+t.charCodeAt(0),0),n=Math.max(.01,Math.min(.6,.02+r%140/1e3));return{retailerId:e,retailerName:e,demand_weekly:Math.round(a),brand_share:n,brand_views_weekly:Math.round(a*n)}})})(),selectedBrandName:er,selectedBrandsHeader:et,showKPIs:ep,showFilters:ex})})]})]}),(0,r.jsx)(v.Z,{hoveredBrand:L,brandData:ey,tooltipPosition:P}),(0,r.jsx)(w.Z,{hoveredDateIdx:K,selectedLegendHosts:H,chartHoverPos:Z,dateLabels:["1 Dec","5 Dec","9 Dec","13 Dec","17 Dec","21 Dec","27 Dec"],getSeriesForRetailer:getSeriesForRetailer,seriesColorByRetailer:es,formatSkus:formatSkus,mode:"brand-performance"===e?"share":"views",allHeaderHosts:ec.map(e=>e.name)})]})}}},function(e){e.O(0,[243,112,858,379,774,888,179],function(){return e(e.s=6822)}),_N_E=e.O()}]);