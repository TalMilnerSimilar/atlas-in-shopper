(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[317],{5315:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cross-retail-analysis-new",function(){return a(248)}])},248:function(e,t,a){"use strict";a.r(t);var r=a(5893),n=a(7294),s=a(6196),l=a(6691),o=a(199),i=a(9057),d=a(5759),c=a(8688),u=a(6116),h=a(7069),m=a(1833),g=a(6420),p=a(1230),f=a(4251),x=a(8908),v=a(9876),S=a(2991),w=a(6360),b=a(8824),y=a(3717),M=a(2074),C=a(1167);t.default=()=>{let[e,t]=(0,n.useState)("retailer-growth"),[a,N]=(0,n.useState)(!0),[E,k]=(0,n.useState)(!1),[F,P]=(0,n.useState)(!1),[T,j]=(0,n.useState)(null),[L,B]=(0,n.useState)({x:0,y:0}),[R,D]=(0,n.useState)(new Set),[I,A]=(0,n.useState)([]),[H,K]=(0,n.useState)(null),[_,Z]=(0,n.useState)({x:0,y:0}),[W,Y]=(0,n.useState)(!0),[O,J]=(0,n.useState)("Jun 2024 - Jul 2024"),[z,G]=(0,n.useState)("Year over Year"),[X,$]=(0,n.useState)("Appliances > Dishwashers"),[q,U]=(0,n.useState)(["All Retailers"]),[V,Q]=(0,n.useState)(["All Brands"]),[ee,et]=(0,n.useState)("Nike"),ea=["#195AFE","#22C55E","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#F97316"],[er,en]=(0,n.useState)({}),[es,el]=(0,n.useState)({}),[eo,ei]=(0,n.useState)([]),[ed,ec]=(0,n.useState)({}),eu=(0,n.useRef)({});(0,n.useEffect)(()=>{let e=!0;return fetch("/data/retailer_series.csv",{cache:"no-store"}).then(e=>e.text()).then(t=>{let a={};t.split(/\r?\n/).forEach(e=>{let t=(e||"").trim();if(!t||t.startsWith("#")||/^key\b/i.test(t))return;let r=t.split(",").map(e=>e.trim());if(r.length<22)return;let n=r[0],s=r.slice(1,8).map(e=>parseInt(e,10)).filter(e=>!Number.isNaN(e)),l=r.slice(8,15).map(e=>parseInt(e,10)).filter(e=>!Number.isNaN(e)),o=r.slice(15,22).map(e=>parseInt(e,10)).filter(e=>!Number.isNaN(e));n&&7===s.length&&7===l.length&&7===o.length&&(a[n.toLowerCase()]={current:s,prevPop:l,prevYoy:o})}),e&&ec(a)}).catch(()=>{}).finally(()=>{}),()=>{e=!1}},[]),(0,n.useEffect)(()=>{let e=localStorage.getItem("marketPositionEnabled");null!==e&&Y(JSON.parse(e));let handleMarketPositionToggle=e=>{Y(e.detail.enabled)};return window.addEventListener("marketPositionToggle",handleMarketPositionToggle),()=>{window.removeEventListener("marketPositionToggle",handleMarketPositionToggle)}},[]);let[eh,em]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("tableKPIsEnabled");null!==e&&em(JSON.parse(e));let handleTableKPIsToggle=e=>{em(e.detail.enabled)};return window.addEventListener("tableKPIsToggle",handleTableKPIsToggle),()=>{window.removeEventListener("tableKPIsToggle",handleTableKPIsToggle)}},[]);let[eg,ep]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("tableFiltersEnabled");null!==e&&ep(JSON.parse(e));let handleTableFiltersToggle=e=>{ep(e.detail.enabled)};return window.addEventListener("tableFiltersToggle",handleTableFiltersToggle),()=>{window.removeEventListener("tableFiltersToggle",handleTableFiltersToggle)}},[]);let[ef,ex]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("groupedByRegionEnabled");null!==e&&ex(JSON.parse(e));let handleGroupedByRegionToggle=e=>{ex(e.detail.enabled)};return window.addEventListener("groupedByRegionToggle",handleGroupedByRegionToggle),()=>{window.removeEventListener("groupedByRegionToggle",handleGroupedByRegionToggle)}},[]);let expandSelectedHosts=e=>{let regionMatch=e=>/^all\s+(us|uk|german|french|canadian|australian)\s+retailers$/i.exec((e||"").trim()),t=b.x.filter(e=>!/^all\s+/i.test(e));if(e.some(e=>/^all\s+retailers$/i.test((e||"").trim())))return t;let a=new Set;e.forEach(e=>{let t=regionMatch(e);t&&a.add(t[1].toLowerCase())});let r=[],addPred=e=>r.push(e);a.has("us")&&addPred(e=>e.endsWith(".com")),a.has("uk")&&addPred(e=>e.endsWith(".co.uk")),a.has("german")&&addPred(e=>e.endsWith(".de")),a.has("french")&&addPred(e=>e.endsWith(".fr")),a.has("canadian")&&addPred(e=>e.endsWith(".ca")),a.has("australian")&&addPred(e=>e.endsWith(".com.au"));let norm=e=>(e||"").trim().toLowerCase(),n=new Set(e.filter(e=>!/^all\s+/i.test(e)).map(e=>norm(e))),s=[];for(let e of t){let t=norm(e);(n.has(t)||r.length>0&&r.some(e=>e(t)))&&s.push(e)}return s},computeSkusForHost=e=>{let t=(e||"").toLowerCase();if(t.includes("amazon"))return 5846;if(t.includes("walmart"))return 3425;if(t.includes("samsung"))return 1468;if(t.includes("bestbuy"))return 968;if(t.includes("ebay"))return 846;if(t.includes("newegg"))return 725;if(t.includes("homedepot"))return 709;if(t.includes("costco"))return 650;if(t.includes("tesco"))return 645;if(t.includes("lowes"))return 599;let a=0;for(let e=0;e<t.length;e++)a=31*a+t.charCodeAt(e)>>>0;return 300+a%1201},formatSkus=e=>e>=1e3?"".concat((e/1e3).toFixed(1).replace(/\.0$/,""),"K"):e.toString(),resolveChartKey=e=>{let t=(e||"").toLowerCase();return t.includes("amazon")?"Amazon.com":t.includes("walmart")?"Walmart.com":t.includes("samsung")?"Samsung.com":t.includes("bestbuy")?"Bestbuy.com":t.includes("ebay")?"Ebay.com":t.includes("newegg")?"Newegg.com":t.includes("homedepot")?"Homedepot.com":t.includes("costco")?"Costco.com":t.includes("tesco")?"Tesco.com":t.includes("lowes")?"Lowes.com":e},hashString=e=>{let t=2166136261;for(let a=0;a<e.length;a++)t^=e.charCodeAt(a),t=Math.imul(t,16777619);return t>>>0},randFromSeed=e=>{let t=(e||1)>>>0;return()=>(t=Math.imul(1664525,t)+1013904223>>>0)/4294967296},generateSeriesForKey=e=>{let t=hashString((e||"").toLowerCase()),a=randFromSeed(t),r=8e4+Math.floor(16e4*a()),n=-.18+.4*a(),s=[];for(let e=0;e<7;e++){let t=e/6,l=(a()-.5)*.1,o=1+n*t+l;s.push(Math.max(1e3,1e3*Math.round(r*o/1e3)))}return s},getSeriesForRetailer=e=>{let t=(e||"").trim().toLowerCase();if(ed[t]&&ed[t].current.length>0)return ed[t].current;let a=(resolveChartKey(e)||"").trim();if(ed[a])return ed[a].current;let r=a.toLowerCase();if(ed[r])return ed[r].current;let n=eu.current;return n[t]||(n[t]=generateSeriesForKey(t)),n[t]},ev=(e=>{let t=0;for(let a=0;a<e.length;a++)t=31*t+e.charCodeAt(a)>>>0;let a=10+t%86,r=Math.max(10,Math.min(95,Math.round(a))),n="".concat((1.5+r/100*17.2).toFixed(1),"M");return{position:"".concat(Math.max(2,Math.min(98,r)),"%"),percentile:r,rank:Math.max(1,Math.min(60,Math.round((100-r)/100*60))),total:60,status:r>=95?"market leader":r>=60?"ahead":r>=45?"median":r>=25?"behind":"trailing",views:n}})(ee),eS={Co:{name:"Coca-Cola",percentile:10,rank:54,total:60,status:"trailing",views:"1.8M"},Pu:{name:"Puma",percentile:25,rank:45,total:60,status:"behind",views:"3.2M"},DM:{name:"Dior & Mo\xebt",percentile:40,rank:36,total:60,status:"behind",views:"5.1M"},Ad:{name:"Adidas",percentile:50,rank:30,total:60,status:"median",views:"7.4M"},[ee]:{name:ee,percentile:ev.percentile,rank:ev.rank,total:ev.total,status:ev.status,views:ev.views},NB:{name:"New Balance",percentile:95,rank:3,total:60,status:"market leader",views:"18.7M"}},ew=(()=>{if(0===I.length)return{min:0,max:100,steps:[0,25,50,75,100]};let e=I.map(e=>getSeriesForRetailer(e)).flat(),t=Math.min(...e),a=Math.max(...e),r=a-t,n=Math.max(0,Math.floor(t-.1*r)),s=Math.ceil(a+.1*r),l=(s-n)/6,o=Array.from({length:7},(e,t)=>Math.round(n+l*t));return{min:n,max:s,steps:o}})(),eb=[...ew.steps].reverse(),ey="Year over Year"===z?"YoY":"PoP",getInsightSeries=()=>I.map(e=>{let t=getSeriesForRetailer(e),a="YoY"===ey,r=e.split("").reduce((e,t)=>e+t.charCodeAt(0),0),n=.85+r%30/100,s=(r%7-3)/100,l=t.map((e,t)=>Math.round(e*Math.max(.5,Math.min(1.5,(a?n:.95+(r+t)%10/100)+s*t))));return{retailer:e,current:t,previous:l}}),eM=(0,n.useMemo)(()=>{if(0===I.length)return{headline:"No retailers selected.",sentence:"Select retailers from the legend to see insights.",chips:[]};if("brand-performance"===e){let e=eo.map(e=>e.name),t=e.map(e=>{let t=getSeriesForRetailer(e),a=e.toLowerCase(),r=ed[a],n=[],s=[];if(r)n=r.prevPop,s=r.prevYoy;else{let a=e.split("").reduce((e,t)=>e+t.charCodeAt(0),0),r=(a%7-3)/100;n=t.map((e,t)=>0===e&&a%3==0?5e4+a%2e4:e>0&&a%4==1?0:Math.round(e*Math.max(.5,Math.min(1.5,1+(((a>>2)+t)%21-10)/100+r*t))));let l=1+(a%51-25)/100;s=t.map((e,t)=>0===e&&a%5==0?4e4+a%15e3:e>0&&a%6==2?0:Math.round(e*Math.max(.5,Math.min(1.5,l+r*t))))}return{retailer:e,current:t,prevPop:n,prevYoy:s}}),a=(0,l.a)(t,{eligible:new Set(I)}),r=[];if(a.tags.pop){let e=a.tags.pop.startsWith("+")?"pos":a.tags.pop.startsWith("−")?"neg":"neu";r.push({text:a.tags.pop,tone:e})}if(a.tags.yoy){let e=a.tags.yoy.startsWith("+")?"pos":a.tags.yoy.startsWith("−")?"neg":"neu";r.push({text:a.tags.yoy,tone:e})}return{headline:a.title,sentence:a.text,chips:r}}let t=getInsightSeries(),a=ey.toLowerCase(),r=(0,s.F)(t,a),n=r.retailer,o=getSeriesForRetailer(n),i=n.split("").reduce((e,t)=>e+t.charCodeAt(0),0),d=(i%7-3)/100,c=o.map((e,t)=>Math.round(e*Math.max(.5,Math.min(1.5,.95+(i+t)%10/100+d*t)))),u=.85+i%30/100,h=o.map((e,t)=>Math.round(e*Math.max(.5,Math.min(1.5,u+d*t)))),m=o.reduce((e,t)=>e+t,0),g=c.reduce((e,t)=>e+t,0),p=h.reduce((e,t)=>e+t,0),f=(m-g)/Math.max(g,1),x=(m-p)/Math.max(p,1),v=[],S=(100*f).toFixed(0);v.push({text:"".concat(f>0?"+":"").concat(S,"% PoP"),tone:f>0?"pos":f<0?"neg":"neu"});let w=(100*x).toFixed(0);return v.push({text:"".concat(x>0?"+":"").concat(w,"% YoY"),tone:x>0?"pos":x<0?"neg":"neu"}),{headline:r.headline,sentence:r.sentence,chips:v}},[I,z,e]);return(0,n.useEffect)(()=>{let e=expandSelectedHosts(q),t=e.map(e=>({name:e,skus:computeSkusForHost(e)}));t.sort((e,t)=>t.skus-e.skus),ei(t);let a=t.slice(0,Math.min(4,t.length)).map(e=>e.name);A(a),D(new Set(a.map(e=>resolveChartKey(e))));let r={};a.forEach((e,t)=>{r[e]=ea[t%ea.length]}),en(r);let n={};a.forEach((e,t)=>{n[e]=t%7}),el(n)},[]),(0,n.useEffect)(()=>{(()=>{let e=localStorage.getItem("navbarPinned");N("false"!==e)})();let handleNavbarChange=e=>{N(e.detail.isPinned)},handleNavbarHoverChange=e=>{k(e.detail.isHovered)};return window.addEventListener("navbarPinChange",handleNavbarChange),window.addEventListener("navbarHoverChange",handleNavbarHoverChange),()=>{window.removeEventListener("navbarPinChange",handleNavbarChange),window.removeEventListener("navbarHoverChange",handleNavbarHoverChange)}},[]),(0,n.useEffect)(()=>{let handleScroll=e=>{let t=e.target,a=t.scrollTop;P(a>100)},e=document.querySelector(".content-area");if(e)return e.addEventListener("scroll",handleScroll),()=>e.removeEventListener("scroll",handleScroll)},[]),(0,r.jsxs)("div",{className:"flex h-screen overflow-hidden",style:{backgroundColor:"#ffffff"},children:[(0,r.jsx)("div",{className:"bg-white border-r border-gray-200 flex flex-col transition-all duration-300 ".concat(a||E?"w-64":"w-12"," ").concat(a?"relative":E?"absolute z-50":"relative"),children:(0,r.jsx)(o.Z,{})}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,r.jsxs)("div",{className:"transition-all duration-300 ".concat(a?"px-16":"px-8"," ").concat(F?"py-3 bg-[#f7f7f8]":"py-4 bg-gray-50"),children:[(0,r.jsx)("div",{className:"transition-all duration-300 ".concat(F?"opacity-0 h-0 overflow-hidden":"opacity-100 h-auto"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-xl font-medium text-gray-900",children:"Cross Retail Analysis"}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-[12px] text-[#6B7C8C] leading-[16px]",style:{fontFamily:"DM Sans, sans-serif"},children:"For"}),(0,r.jsx)(h.Z,{value:O,onDateChange:(e,t)=>{let formatDate=e=>e.toLocaleDateString("en-US",{month:"short",year:"numeric"});J("".concat(formatDate(e)," - ").concat(formatDate(t)))}})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-[12px] text-[#6B7C8C] leading-[16px]",style:{fontFamily:"DM Sans, sans-serif"},children:"Compared to"}),(0,r.jsx)(u.Z,{label:"",value:z,options:C.A,onChange:G})]})]})]})}),(0,r.jsx)("div",{className:"transition-all duration-300 ".concat(F?"mt-0":"mt-4"),children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(i.Z,{label:"Category",value:X,options:w.O,onChange:$}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Across"}),(0,r.jsx)(d.Z,{label:"Retailers",value:q,options:b.x,onChange:e=>{U(e);let t=expandSelectedHosts(e),a=t.map(e=>({name:e,skus:computeSkusForHost(e)}));a.sort((e,t)=>t.skus-e.skus),ei(a);let r=a.slice(0,Math.min(4,a.length)).map(e=>e.name);A(r),D(new Set(r.map(e=>resolveChartKey(e))));let n={};r.forEach((e,t)=>{n[e]=ea[t%ea.length]}),en(n);let s={};r.forEach((e,t)=>{s[e]=t%7}),el(s)},showGroupedByRegion:ef}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"For"}),(0,r.jsx)(c.Z,{label:"Brands",value:V,options:M.K,onChange:Q}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Against my brand"}),(0,r.jsx)(i.Z,{label:"My Brand",value:ee,options:y.t,onChange:et})]})})]}),(0,r.jsxs)("div",{className:"content-area flex-1 overflow-y-auto transition-all duration-300 ".concat(a?"px-16 py-8":"px-16 py-6"),children:[(0,r.jsx)(m.Z,{}),(0,r.jsx)(g.Z,{onNavigateToTab:e=>{t(e),setTimeout(()=>{let e=document.querySelector("[data-chart-section]");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)}}),W&&(0,r.jsx)(p.Z,{brandSel:ee,currentBrandData:ev,brandData:eS,onBrandHover:(e,t)=>{j(e),B({x:t.clientX,y:t.clientY})},onBrandLeave:()=>{j(null)},getOrdinal:e=>{let t=e%10,a=e%100;return 1===t&&11!==a?"".concat(e,"st"):2===t&&12!==a?"".concat(e,"nd"):3===t&&13!==a?"".concat(e,"rd"):"".concat(e,"th")},getBrandHeadline:(e,t)=>{switch(e){case"market leader":return"".concat(t," is the market leader");case"ahead":return"".concat(t," is ahead of the median");case"median":return"".concat(t," is around the median");case"behind":return"".concat(t," is behind the median");case"trailing":return"".concat(t," is trailing the category");default:return"".concat(t," performance insight")}}}),(0,r.jsx)("div",{"data-chart-section":!0,children:(0,r.jsx)(f.Z,{activeTab:e,setActiveTab:t,selectedLegendHosts:I,selectedBrandName:ee,yAxisScale:ew,reversedSteps:eb,formatSkus:formatSkus,getSeriesForRetailer:getSeriesForRetailer,seriesColorByRetailer:er,hoveredDateIdx:H,setHoveredDateIdx:K,setChartHoverPos:Z,legendRetailers:eo,maxRetailerSelections:7,onRetailerToggle:e=>{A(t=>{let a=t.includes(e),r=a?t.filter(t=>t!==e):t.length<7?[...t,e]:t;D(new Set(r.map(e=>resolveChartKey(e))));let n={};r.forEach((e,t)=>{n[e]=ea[t%ea.length]}),en(n);let s={};return r.forEach((e,t)=>{s[e]=t%7}),el(s),r})},onClearAll:()=>{A([]),D(new Set),en({})},onSelectAll:()=>{let e=eo.slice(0,7).map(e=>e.name);A(e);let t=e.map(e=>resolveChartKey(e));D(new Set(t));let a={};e.forEach((e,t)=>{a[e]=ea[t%ea.length]}),en(a);let r={};e.forEach((e,t)=>{r[e]=t%7}),el(r)},isLegendItemDisabled:e=>!I.includes(e)&&I.length>=7,dynamicInsight:eM})}),(0,r.jsx)("div",{className:"mt-10",children:(0,r.jsx)(x.Z,{retailers:(()=>{let e=eo.map(e=>e.name);return e.map(e=>{let t=getSeriesForRetailer(e),a=t.reduce((e,t)=>e+t,0)/Math.max(1,t.length),r=e.split("").reduce((e,t)=>e+t.charCodeAt(0),0),n=Math.max(.01,Math.min(.6,.02+r%140/1e3));return{retailerId:e,retailerName:e,demand_weekly:Math.round(a),brand_share:n,brand_views_weekly:Math.round(a*n)}})})(),selectedBrandName:ee,selectedBrandsHeader:V,showKPIs:eh,showFilters:eg})})]})]}),(0,r.jsx)(v.Z,{hoveredBrand:T,brandData:eS,tooltipPosition:L}),(0,r.jsx)(S.Z,{hoveredDateIdx:H,selectedLegendHosts:I,chartHoverPos:_,dateLabels:["1 Dec","5 Dec","9 Dec","13 Dec","17 Dec","21 Dec","27 Dec"],getSeriesForRetailer:getSeriesForRetailer,seriesColorByRetailer:er,formatSkus:formatSkus,mode:"brand-performance"===e?"share":"views",allHeaderHosts:eo.map(e=>e.name)})]})}}},function(e){e.O(0,[243,868,665,5,774,888,179],function(){return e(e.s=5315)}),_N_E=e.O()}]);